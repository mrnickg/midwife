jQuery(function(e){var a={init:function(){e("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),e("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),e("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),e("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),e(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),e(".wc-bookings-date-picker").each(function(){var t=e(this).closest("form"),i=t.find(".picker"),o=e(this).closest("fieldset");a.date_picker_init(i),"always_visible"==i.data("display")?(e(".wc-bookings-date-picker-date-fields",o).hide(),e(".wc-bookings-date-picker-choose-date",o).hide()):i.hide(),i.data("is_range_picker_enabled")&&(t.find("p.wc_bookings_field_duration").hide(),t.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==i.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(e){var a=e.closest("form"),t=e.closest("fieldset");setTimeout(function(){var e=1,i=parseInt(t.find("input.booking_to_date_year").val()),o=parseInt(t.find("input.booking_to_date_month").val()),n=parseInt(t.find("input.booking_to_date_day").val()),_=parseInt(t.find("input.booking_date_year").val()),d=parseInt(t.find("input.booking_date_month").val()),r=parseInt(t.find("input.booking_date_day").val());if(i&&o>=0&&n&&_&&d>=0&&r){var s=new Date(_,d-1,r),l=new Date(i,o-1,n);e=Math.floor((l.getTime()-s.getTime())/864e5)+1}a.find("#wc_bookings_field_duration").val(e).change()})},toggle_calendar:function(){$picker=e(this).closest("fieldset").find(".picker:eq(0)"),a.date_picker_init($picker),$picker.slideToggle()},input_date_trigger:function(){var t=e(this).closest("fieldset"),i=t.find(".picker:eq(0)"),o=e(this).closest("form"),n=parseInt(t.find("input.booking_date_year").val(),10),_=parseInt(t.find("input.booking_date_month").val(),10),d=parseInt(t.find("input.booking_date_day").val(),10);if(n&&_&&d){var r=new Date(n,_-1,d);if(i.datepicker("setDate",r),i.data("is_range_picker_enabled")){var s=parseInt(t.find("input.booking_to_date_year").val(),10),l=parseInt(t.find("input.booking_to_date_month").val(),10),k=parseInt(t.find("input.booking_to_date_day").val(),10),g=new Date(s,l-1,k);!g||r>g?(t.find("input.booking_to_date_year").val("").addClass("error"),t.find("input.booking_to_date_month").val("").addClass("error"),t.find("input.booking_to_date_day").val("").addClass("error")):(t.find("input").removeClass("error"),a.calc_duration(i))}o.find(".wc-bookings-booking-form").triggerHandler("date-selected",r),jQuery("#postpartum_main_form").show()}},select_date_trigger:function(t){var i=e(this).closest("fieldset"),o=i.find(".picker:eq(0)"),n=e(this).closest("form"),_=t.split("-"),d=o.data("start_or_end_date");o.data("is_range_picker_enabled")&&d||(d="start"),"end"===d?(o.data("min_date",o.data("o_min_date")),i.find("input.booking_to_date_year").val(_[0]),i.find("input.booking_to_date_month").val(_[1]),i.find("input.booking_to_date_day").val(_[2]).change(),o.data("is_range_picker_enabled")&&a.calc_duration(o),o.data("start_or_end_date","start"),o.data("is_range_picker_enabled")&&n.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==o.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date),"always_visible"!==o.data("display")&&e(this).hide()):(o.data("is_range_picker_enabled")&&(o.data("o_min_date",o.data("min_date")),o.data("min_date",t)),i.find("input.booking_to_date_year").val(""),i.find("input.booking_to_date_month").val(""),i.find("input.booking_to_date_day").val(""),i.find("input.booking_date_year").val(_[0]),i.find("input.booking_date_month").val(_[1]),i.find("input.booking_date_day").val(_[2]).change(),o.data("is_range_picker_enabled")&&a.calc_duration(o),o.data("start_or_end_date","end"),o.data("is_range_picker_enabled")&&n.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===o.data("display")||o.data("is_range_picker_enabled")||e(this).hide()),n.find(".wc-bookings-booking-form").triggerHandler("date-selected",t,d),jQuery("#postpartum_main_form").show()},date_picker_init:function(t){if(e(t).is(".picker"))var i=e(t);else var i=e(this).closest("form").find(".picker:eq(0)");i.empty().removeClass("hasDatepicker").datepicker({dateFormat:e.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:a.is_bookable,onSelect:a.select_date_trigger,minDate:i.data("min_date"),maxDate:i.data("max_date"),defaultDate:i.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNames:wc_bookings_booking_form.dayNames,dayNamesShort:wc_bookings_booking_form.dayNamesShort,dayNamesMin:wc_bookings_booking_form.dayNamesMin,firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0}),e(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var o=i.closest("form"),n=parseInt(o.find("input.booking_date_year").val(),10),_=parseInt(o.find("input.booking_date_month").val(),10),d=parseInt(o.find("input.booking_date_day").val(),10);if(n&&_&&d){var r=new Date(n,_-1,d);i.datepicker("setDate",r)}},get_input_date:function(e,a){var t=e.find("input.booking_"+a+"date_year"),i=e.find("input.booking_"+a+"date_month"),o=e.find("input.booking_"+a+"date_day");return 0!==t.val().length&&0!==i.val().length&&0!==o.val().length?t.val()+"-"+i.val()+"-"+o.val():""},is_bookable:function(t){var i=e(this).closest("form"),o=i.find(".picker:eq(0)"),n=e(this).data("availability"),_=e(this).data("default-availability"),d=e(this).data("fully-booked-days"),r=e(this).data("partially-booked-days"),s=wc_bookings_booking_form.check_availability_against,l="";if(i.find("select#wc_bookings_field_resource").val()>0)var k=i.find("select#wc_bookings_field_resource").val();else var k=0;var g=wc_bookings_booking_form.booking_duration,c=new Date(t),f=c.getFullYear(),b=c.getMonth()+1,p=c.getDate();if(d[f+"-"+b+"-"+p]&&(d[f+"-"+b+"-"+p][0]||d[f+"-"+b+"-"+p][k]))return[!1,"fully_booked",booking_form_params.i18n_date_unavailable];if(""+f+b+p<wc_bookings_booking_form.current_time)return[!1,"not_bookable",""];if(r&&r[f+"-"+b+"-"+p]&&(r[f+"-"+b+"-"+p][0]||r[f+"-"+b+"-"+p][k])&&(l+="partial_booked "),i.find("#wc_bookings_field_duration").size()>0&&"minute"!=wc_bookings_booking_form.duration_unit&&"hour"!=wc_bookings_booking_form.duration_unit&&!o.data("is_range_picker_enabled"))var u=i.find("#wc_bookings_field_duration").val(),m=g*u;else var m=g;(1>m||"start"==s)&&(m=1);for(var h=_,v=0;m>v;v++){var c=new Date(t);c.setDate(c.getDate()+v);var f=c.getFullYear(),b=c.getMonth()+1,p=c.getDate(),y=c.getDay(),w=e.datepicker.iso8601Week(c);if(h=_,0==y&&(y=7),e.each(n[k],function(e,a){var t=a[0],i=a[1];try{switch(t){case"months":if("undefined"!=typeof i[b])return h=i[b],!1;break;case"weeks":if("undefined"!=typeof i[w])return h=i[w],!1;break;case"days":if("undefined"!=typeof i[y])return h=i[y],!1;break;case"custom":if("undefined"!=typeof i[f][b][p])return h=i[f][b][p],!1}}catch(o){}return!0}),d[f+"-"+b+"-"+p]&&(d[f+"-"+b+"-"+p][0]||d[f+"-"+b+"-"+p][k])&&(h=!1),!h)break}if(h){if(o.data("is_range_picker_enabled")){var D=e(this).closest("fieldset"),I=e.datepicker.parseDate(e.datepicker.ISO_8601,a.get_input_date(D,"")),N=e.datepicker.parseDate(e.datepicker.ISO_8601,a.get_input_date(D,"to_"));return[h,I&&(t.getTime()===I.getTime()||N&&t>=I&&N>=t)?l+"bookable-range":l+"bookable",""]}return[h,l+"bookable",""]}return[h,"not_bookable",""]}};a.init()});